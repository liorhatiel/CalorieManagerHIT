<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>Calorie Management</title>
  </head>
  <body>
    <nav class="nav-bar">
      <h2>Logo png</h2>
      <div class="nav-bar-btns">
        <a href="#" class="btn-add-item active" id="btn-add-item">Add Item</a>
        <a href="#" class="btn-show-report" id="btn-show-report">Calorie Report</a>
      </div>
    </nav>

    <div class="app-container">
      <!-- Add New Item Section -->
      <div id="add-item-window">
        <h1 class="add-item-heading">Add New Item</h1>
        <form id="calorieForm">
          <div class="form-group">
            <label for="category" class="label">Category:</label>
            <select id="category" name="category">
              <option value="BREAKFAST">BREAKFAST</option>
              <option value="LUNCH">LUNCH</option>
              <option value="DINNER">DINNER</option>
              <option value="SNACK">SNACK</option>
            </select>
          </div>

          <div class="form-group">
            <label for="description" class="label">Description:</label>
            <input
              type="text"
              id="description"
              name="description"
              placeholder="What did you eat?"
              required
            />
          </div>

          <div class="form-group">
            <label for="calories" class="label">Calories:</label>
            <input
              type="number"
              id="calories"
              name="calories"
              placeholder="How many calories?"
              required
            />
          </div>

          <button type="submit" class="add-item-submit-btn">Create Item</button>
          <div class="user-feedback" id="user-feedback"></div>
        </form>
      </div>

      <!-- Calorie Report Section -->
      <div id="calorie-report-window" style="display: none;">
        <h1 class="calorie-report-heading">Calorie Report</h1>
        <div class="year-and-month-heading">
          <div class="me-2">
            <label for="year" class="label">Select Year:</label>
            <select class="select-input" id="year">
              <option value="2024">2024</option>
              <option value="2025">2025</option>
              <option value="2026">2026</option>
              <option value="2027">2027</option>
              <option value="2028">2028</option>
              <option value="2029">2029</option>
              <option value="2030">2030</option>
            </select>
          </div>
          <div>
            <label for="month" class="label">Select Month:</label>
            <select class="select-input" id="month">
              <option value="1">January</option>
              <option value="2">February</option>
              <option value="3">March</option>
              <option value="4">April</option>
              <option value="5">May</option>
              <option value="6">June</option>
              <option value="7">July</option>
              <option value="8">August</option>
              <option value="9">September</option>
              <option value="10">October</option>
              <option value="11">November</option>
              <option value="12">December</option>
            </select>
          </div>
        </div>

        <!-- The table for calorie report -->
        <table class="table">
          <thead>
            <tr>
              <th>Category</th>
              <th>Calories</th>
              <th>Description</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody id="calorie-report-body"></tbody>
        </table>
      </div>
    </div>

    <script src="idb.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        const addItemWindow = document.getElementById("add-item-window");
        const reportWindow = document.getElementById("calorie-report-window");

        const btnAddItem = document.getElementById("btn-add-item");
        const btnShowReport = document.getElementById("btn-show-report");

        let db;

        // Open the database
        openCaloriesDB("caloriesdb", 1)
          .then((database) => {
            db = database;
          })
          .catch((err) => console.error(err));

        // Switch to "Add Item" view
        btnAddItem.addEventListener("click", () => {
          addItemWindow.style.display = "block";
          reportWindow.style.display = "none";
        });

        // Switch to "Calorie Report" view
        btnShowReport.addEventListener("click", async () => {
          addItemWindow.style.display = "none";
          reportWindow.style.display = "block";
          await displayCalorieReport();
        });

        // Handle form submission to add calorie data
        const calorieForm = document.getElementById("calorieForm");
        calorieForm.addEventListener("submit", async (event) => {
          event.preventDefault();
          const category = document.getElementById("category").value;
          const description = document.getElementById("description").value;
          const calories = parseInt(document.getElementById("calories").value);

          const calorieData = {
            calorie: calories,
            category: category,
            description: description,
            date: new Date(),
          };

          // Add data to IndexedDB
          try {
            await addCalories(db, calorieData);
            document.getElementById("user-feedback").textContent =
              "Calorie item added successfully!";
            calorieForm.reset();
          } catch (error) {
            document.getElementById("user-feedback").textContent =
              "Failed to add calorie item.";
          }
        });

        // Display calorie report
        async function displayCalorieReport() {
          const year = parseInt(document.getElementById("year").value);
          const month = parseInt(document.getElementById("month").value);
          const calorieEntries = await getCaloriesByMonthAndYear(db, month, year);

          const reportBody = document.getElementById("calorie-report-body");
          reportBody.innerHTML = "";

          if (calorieEntries.length === 0) {
            reportBody.innerHTML = "<tr><td colspan='4'>No data found.</td></tr>";
          } else {
            calorieEntries.forEach((entry) => {
              const row = document.createElement("tr");
              row.innerHTML = `
                <td>${entry.category}</td>
                <td>${entry.calorie}</td>
                <td>${entry.description}</td>
                <td>${new Date(entry.date).toLocaleDateString()}</td>
              `;
              reportBody.appendChild(row);
            });
          }
        }
      });
    </script>
  </body>
</html>
